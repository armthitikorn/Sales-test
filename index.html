<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Telesales Training Simulator</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --text: #1e293b;
        }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 800px; background: white; border-radius: 16px; shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 25px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        header { border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; margin-bottom: 20px; text-align: center; }
        
        /* Chat Area */
        #chat-window { height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 12px; background: #ffffff; }
        .msg { max-width: 80px; padding: 12px 16px; border-radius: 12px; line-height: 1.5; font-size: 15px; }
        .customer { align-self: flex-start; background: #f1f5f9; color: #334155; border-bottom-left-radius: 2px; }
        .agent { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        
        /* Controls */
        .controls { display: flex; flex-direction: column; gap: 10px; }
        .status-bar { text-align: center; font-size: 14px; font-weight: bold; padding: 8px; border-radius: 8px; background: #f1f5f9; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        #start-btn { background: #10b981; color: white; }
        #start-btn:hover { background: #059669; }
        #stop-btn { background: #ef4444; color: white; }
        
        .api-config { margin-bottom: 15px; font-size: 12px; }
        input[type="password"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h2>üéß AI Telesales Role-Play</h2>
        <p>‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</p>
    </header>

    <div class="api-config">
        <label>‡πÉ‡∏™‡πà Gemini API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
        <input type="password" id="api-key" placeholder="Paste your API Key here...">
    </div>

    <div id="status" class="status-bar">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>

    <div id="chat-window">
        <div class="msg customer">‡∏£‡∏∞‡∏ö‡∏ö: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</div>
    </div>

    <div class="controls">
        <div class="btn-group">
            <button id="start-btn">üéôÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î (Hold to Talk)</button>
        </div>
        <small style="text-align: center; color: #64748b;">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏û‡∏π‡∏î‡∏à‡∏ö*</small>
    </div>
</div>

<script>
    // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ---
    const chatWindow = document.getElementById('chat-window');
    const statusBox = document.getElementById('status');
    const apiKeyInput = document.getElementById('api-key');
    const startBtn = document.getElementById('start-btn');

    // ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Web Speech API (‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á)
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = (Recognition) ? new Recognition() : null;
    if(recognition) {
        recognition.lang = 'th-TH';
        recognition.continuous = false;
        recognition.interimResults = false;
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---

    startBtn.onclick = () => {
        if (!apiKeyInput.value) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            return;
        }
        recognition.start();
        updateStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...", "#fbbf24");
    };

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        appendMessage('agent', transcript);
        askGemini(transcript);
    };

    async function askGemini(userInput) {
        const apiKey = apiKeyInput.value;
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
        
        updateStatus("AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...", "#60a5fa");

        const systemPrompt = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏û‡∏£' ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏∏‡πà‡∏á‡∏°‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÇ‡∏î‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏ó‡∏£‡∏°‡∏≤‡∏Ç‡∏±‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô " +
                             "‡∏ô‡∏¥‡∏™‡∏±‡∏¢: ‡∏û‡∏π‡∏î‡∏ô‡πâ‡∏≠‡∏¢, ‡∏Ç‡∏µ‡πâ‡∏£‡∏≥‡∏Ñ‡∏≤‡∏ç, ‡∏ä‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏à‡∏µ‡πâ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤ " +
                             "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡πÇ‡∏ï‡πâ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏¢‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß, ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á, ‡πÅ‡∏û‡∏á‡πÑ‡∏õ) " +
                             "‡∏ñ‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏π‡∏î‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡πâ‡∏≤‡∏ß‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏¢‡∏≠‡∏°‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠";

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `${systemPrompt}\n\n‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏û‡∏π‡∏î‡∏ß‡πà‡∏≤: "${userInput}"` }] }]
                })
            });

            const data = await response.json();
            const aiText = data.candidates[0].content.parts[0].text;
            
            appendMessage('customer', aiText);
            speak(aiText);
            updateStatus("‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠", "#10b981");

        } catch (error) {
            console.error(error);
            updateStatus("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!", "#ef4444");
        }
    }

    function appendMessage(role, text) {
        const div = document.createElement('div');
        div.className = `msg ${role}`;
        div.innerText = (role === 'agent' ? 'üôã‚Äç‚ôÇÔ∏è ‡∏Ñ‡∏∏‡∏ì: ' : 'üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ') + text;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'th-TH';
        window.speechSynthesis.speak(utterance);
    }

    function updateStatus(text, color) {
        statusBox.innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${text}`;
        statusBox.style.background = color;
        statusBox.style.color = (color === "#fbbf24") ? "black" : "white";
    }
</script>

</body>
</html>
