<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Telesales Simulator v2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --white: #ffffff; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 700px; background: var(--white); border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden; display: flex; flex-direction: column; }
        
        /* Header */
        header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        header h2 { margin: 0; font-size: 1.5rem; }
        
        /* API Key Section */
        .api-section { padding: 15px 20px; background: #e2e8f0; border-bottom: 1px solid #cbd5e1; font-size: 13px; }
        input[type="password"] { width: 100%; padding: 8px; border: 1px solid #94a3b8; border-radius: 6px; box-sizing: border-box; }

        /* Chat Window */
        #chat-window { height: 400px; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; background: #fafafa; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 15px; line-height: 1.5; position: relative; }
        .customer { align-self: flex-start; background: #e9ecef; color: #1e293b; border-bottom-left-radius: 2px; }
        .agent { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }

        /* Control Panel */
        .controls { padding: 20px; border-top: 1px solid #e2e8f0; text-align: center; }
        .status-bar { margin-bottom: 15px; font-weight: bold; font-size: 14px; transition: 0.3s; padding: 8px; border-radius: 10px; }
        
        button { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-ready { background: #10b981; color: white; }
        .btn-listening { background: #f59e0b; color: white; animation: pulse 1.5s infinite; }
        .btn-disabled { background: #94a3b8; color: white; cursor: not-allowed; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>üéß AI Telesales Role-Play</h2>
        <small>‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö Real-time</small>
    </header>

    <div class="api-section">
        <label>‡∏õ‡πâ‡∏≠‡∏ô Gemini API Key:</label>
        <input type="password" id="api-key" placeholder="‡∏ß‡∏≤‡∏á API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
    </div>

    <div id="chat-window">
        <div class="msg customer">‡∏£‡∏∞‡∏ö‡∏ö: ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏£‡∏±‡∏ö? ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
    </div>

    <div class="controls">
        <div id="status" class="status-bar" style="background: #f1f5f9; color: #64748b;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
        <button id="talk-btn" class="btn-ready">üéôÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î (Push to Talk)</button>
    </div>
</div>

<script>
    const talkBtn = document.getElementById('talk-btn');
    const statusBox = document.getElementById('status');
    const chatWindow = document.getElementById('chat-window');
    const apiKeyInput = document.getElementById('api-key');

    let isListening = false;

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Web Speech API (‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á) ---
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new Recognition();
    recognition.lang = 'th-TH';
    recognition.interimResults = false;
    recognition.continuous = false;

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° ---
    talkBtn.onclick = () => {
        if (!apiKeyInput.value) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏±‡∏ö");
            return;
        }

        if (isListening) return; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡∏Ç‡∏ì‡∏∞‡πÑ‡∏°‡∏Ñ‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö)

        try {
            recognition.start();
        } catch (e) {
            console.error("Recognition error:", e);
        }
    };

    recognition.onstart = () => {
        isListening = true;
        updateUI('listening');
    };

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        appendMessage('agent', text);
        askGemini(text);
    };

    recognition.onend = () => {
        isListening = false;
        if (statusBox.innerText.includes("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á")) {
            updateUI('ready');
        }
    };

    recognition.onerror = () => {
        isListening = false;
        updateUI('ready');
        statusBox.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á";
    };

    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Gemini AI ---
    async function askGemini(userInput) {
        const apiKey = apiKeyInput.value;
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
        
        updateUI('thinking');

        const systemPrompt = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πÄ‡∏ó‡∏û' ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∏‡πà‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô " +
                             "‡∏ô‡∏¥‡∏™‡∏±‡∏¢: ‡∏Ç‡∏µ‡πâ‡∏£‡∏≥‡∏Ñ‡∏≤‡∏ç ‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥ ‡πÄ‡∏ä‡πà‡∏ô '‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ó‡∏≤‡∏á‡πÑ‡∏•‡∏ô‡πå‡∏û‡∏≠' " +
                             "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡πâ‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏≠‡∏°‡∏ü‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ " +
                             "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏¢‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏à‡∏£‡∏¥‡∏á";

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `${systemPrompt}\n\n‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏û‡∏π‡∏î‡∏ß‡πà‡∏≤: "${userInput}"` }] }]
                })
            });

            const data = await response.json();
            const aiText = data.candidates[0].content.parts[0].text;
            
            appendMessage('customer', aiText);
            speak(aiText);
            updateUI('ready');

        } catch (error) {
            statusBox.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: AI ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á (‡πÄ‡∏ä‡πá‡∏Å API Key)";
            updateUI('ready');
        }
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏° ---
    function updateUI(state) {
        if (state === 'listening') {
            statusBox.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏π‡∏î...";
            statusBox.style.background = "#fef3c7";
            statusBox.style.color = "#92400e";
            talkBtn.className = "btn-listening";
            talkBtn.innerText = "üõë ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á...";
        } else if (state === 'thinking') {
            statusBox.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...";
            statusBox.style.background = "#dbeafe";
            statusBox.style.color = "#1e40af";
            talkBtn.className = "btn-disabled";
            talkBtn.innerText = "‚åõ ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...";
        } else {
            statusBox.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠";
            statusBox.style.background = "#d1fae5";
            statusBox.style.color = "#065f46";
            talkBtn.className = "btn-ready";
            talkBtn.innerText = "üéôÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î (Push to Talk)";
        }
    }

    function appendMessage(role, text) {
        const div = document.createElement('div');
        div.className = `msg ${role}`;
        div.innerText = (role === 'agent' ? 'üôã‚Äç‚ôÇÔ∏è ‡∏Ñ‡∏∏‡∏ì: ' : 'üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ') + text;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'th-TH';
        window.speechSynthesis.speak(utterance);
    }
</script>

</body>
</html>
